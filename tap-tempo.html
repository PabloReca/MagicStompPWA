<!DOCTYPE html>
<html>
<head>
    <title>Tempo LED</title>
    <style>
        #myLED {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: grey;
        }

        #tempoButton {
            position: relative;
            top: 200px;
            left: 200px;
        }

        #bpmDisplay {
            position: relative;
            top: 250px;
            left: 200px;
            font-size: 20px;
        }
    </style>
</head>
<body>
<div id="myLED"></div>
<button id="tempoButton">Calcula el Tempo</button>
<div id="bpmDisplay">BPM:</div>
<script>
    const clickTimes = [];
    const tapButton = document.getElementById("tapButton");
    const led = document.getElementById("B1L2");
    let intervalId = null;
    let bpmArray = [];

    function calculateAverageBPM(times) {
        if (times.length < 2) return 0;
        const differences = times.slice(1).map((value, index) => value - times[index]);
        const averageDifference = differences.reduce((a, b) => a + b, 0) / differences.length;
        return 60000 / averageDifference;
    }

    function calculateMovingAverage(bpmArray) {
        if (bpmArray.length === 0) return 0;
        const sum = bpmArray.reduce((a, b) => a + b, 0);
        return sum / bpmArray.length;
    }

    tapButton.addEventListener("click", function() {
        clickTimes.push(Date.now());
        if (clickTimes.length > 1) {
            let frequency = calculateAverageBPM(clickTimes.slice(-2));
            bpmArray.push(frequency);
            if (bpmArray.length > 4) bpmArray.shift();
            frequency = calculateMovingAverage(bpmArray);
            let beatTime = 60000 / frequency;

            if(intervalId !== null){
                clearInterval(intervalId);
            }
            intervalId = setInterval(function(){
                led.classList.toggle('activo');
            }, beatTime);
        }
    });
</script>
</body>
</html>
